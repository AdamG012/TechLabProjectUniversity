<!DOCTYPE html>
{% load static %}

<html>
    <head>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-67897930-9"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
         
          gtag('config', 'UA-67897930-9');
        </script>
        <title>{% block title %}{% endblock %}</title>

        <link rel="shortcut icon" href="{% static 'placeholders/favicon.jpg.ico' %}">

        <!-- include Bootstrap 4 CSS & JS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans 100, 200, 300, 400, 500, light, normal|Quicksand" rel="stylesheet">

        <link rel="stylesheet" href="{% static 'trendreport/css/core.css' %}">
        <link rel="stylesheet" href="{% static 'trendreport/css/style.css' %}">
        <link rel="stylesheet" href="{% static 'trendreport/css/font-awesome.min.css' %}">

        <!-- jQuery UI -->
        <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">

        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>

        {% block facebookmeta %}{% endblock %}

    </head>
    <body>
    {% block backupWallpaper %}{% endblock %}
    <!--Facebook comments api script (don't move)-->
    <div id="fb-root"></div>
    <script>
    (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = 'https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.10&appId=1878293905819089';
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
    </script>

    {% block facebook %}{% endblock %}

    {% block parallex_open %}{% endblock %}

    <div class="blur-field">
        <div class="container">
            <header>
                <nav class="navbar navbar-expand-lg navbar-dark justify-content-between">
                    <a href="{% url 'trends_index' %}" class="navbar-brand">
                        <h1 class="heading-resp text-wrap animated pulse">The Trend Report</h1>
                    </a>

                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
                        <ul class="navbar-nav">
                            <li class="nav-item">
                            {% if request.resolver_match.url_name == 'trends_index' %}
                                <a class="nav-link active" href="{% url 'trends_index' %}">Home</a>
                            {% else %}
                                <a class="nav-link" href="{% url 'trends_index' %}">Home</a>
                            {% endif %}
                            </li>

                            <li class="nav-item">
                            {% if request.resolver_match.url_name == 'icttechlab_page' %}
                                <a class="nav-link active" href="{% url 'icttechlab_page' %}">ICT Techlab</a>
                            {% else %}
                                <a class="nav-link" href="{% url 'icttechlab_page' %}">ICT Techlab</a>
                            {% endif %}
                            </li>

                            <li class="nav-item">
                            {% if request.resolver_match.url_name == 'principles_page' %}
                                <a class="nav-link active" href="{% url 'principles_page' %}">Principles</a>
                            {% else %}
                                <a class="nav-link" href="{% url 'principles_page' %}">Principles</a>
                            {% endif %}
                            </li>

                            <li>
                                <a class="nav-link" href="#search">Search</a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </header>
        </div>
    </div>
        <!--Search box-->
        <div id="search" class="no-blur-field">
            <button type="submit" id="close-search">×</button>
            <div class="flex-column mx-auto">
                <div class="search-text">
                    <form id="search-bar text-center">
                        <input name="finder" type="search" id="search_box" autocomplete="off" placeholder="Search"/>
                    </form>
                </div>

                <div id="results">
                    <div class="container">

                    </div>
                </div>​
            </div>
        </div>

    <div class="blur-field">
        <main>
            <div class="container">
                {% block content %}{% endblock %}
            </div>
        </main>

        <!--footer-->
        <footer class="footer1">
            <hr id="footer-rule">
            <div class="container">
                <div class="row"><!-- row -->
                    <div class="col-lg-4 col-md-4"><!-- widgets column left -->
                        <ul class="list-unstyled clear-margins"><!-- widgets -->
                            <li class="widget-container widget_nav_menu"><!-- widgets list -->
                                <h1 class="title-widget">Admin</h1>
                                <ul>
                                    <li><a  href="{% url 'admin:index' %}"><i class="fa fa-angle-double-right"></i> Admin Login</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div><!-- widgets column left end -->

                    <div class="col-lg-4 col-md-4"><!-- widgets column left -->
                        <ul class="list-unstyled clear-margins"><!-- widgets -->
                            <li class="widget-container widget_nav_menu"><!-- widgets list -->
                                <h1 class="title-widget">Useful links</h1>
                                <ul>
                                    <li><a  href="{% url 'icttechlab_page' %}"><i class="fa fa-angle-double-right"></i> About ICT Techlab</a></li>
                                    <li><a  href="https://sydney-innovation.ideascale.com/"><i class="fa fa-angle-double-right"></i> OPERATIONS Website</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div><!-- widgets column left end -->

                    <div class="col-lg-4 col-md-4"><!-- widgets column center -->
                        <ul class="list-unstyled clear-margins"><!-- widgets -->
                            <li class="widget-container widget_recent_news"><!-- widgets list -->
                                <h1 class="title-widget">Contact Details </h1>
                                <div class="footerp">
                                <p><b>Email: </b> <a href="mailto:techlab@sydney.edu.au">techlab@sydney.edu.au</a></p>
                                </div>
                                <div class="social-icons">
                                    <ul class="nomargin">
                                        <a href="https://www.facebook.com/usydtechlab/"><i class="fa fa-facebook-square fa-3x social social-fb"></i></a>
                                        <a href="https://twitter.com/usydtechlab?lang=en"><i class="fa fa-twitter-square fa-3x social social-tw"></i></a>
                                        <a href="mailto:techlab@sydney.edu.au"><i class="fa fa-envelope-square fa-3x social social-em"></i></a>
                                    </ul>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <!--Lower footer containing copyright-->
            <div class="footer-bottom">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                            <div class="copyright">
                                © 2017, ICT Techlab. All rights reserved.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>


    {% block parallex_close %}{% endblock %}

        <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>

        <!--Search functionality-->
        <script>
        $("#search_box").on("keyup", debounce(function() {

            if ("jim cook".toUpperCase() == this.value.toUpperCase()) {
                if($("#easter-egg").length == 0) {
                    var egg = document.createElement("img");
                    egg.src = "{% static 'images/jim.png' %}";
                    egg.id = "easter-egg";
                    document.body.insertBefore(egg, document.body.firstChild);
                    setTimeout(function() {
                        $('#easter-egg').addClass("easter-egg-on");
                    }, 1);
                    setTimeout(function() {
                        $('#easter-egg').removeClass("easter-egg-on").addClass("easter-egg-off")
                    }, 3000);
                    setTimeout(function() {
                        $('#easter-egg').remove()
                    }, 6000);
                }
            }

            $.getJSON('//trends.techlab.works/search-results/?q=' + this.value, function(data) {

                // Parse trends and projects
                var trends = JSON.parse(data.trend_results);
                var projects = JSON.parse(data.project_results);

                var trend_html = '';
                if (trends.length > 0) {
                    trend_html += '<div class="row">'+
                        '<div class="col-12"><h1>Trends</h1></div>';
                    for (i = 0; i < trends.length; i++) {
                        trend = trends[i];
                        trend_fields = trend.fields;

                        trend_html += '<div class="search-result trend col-xs-12 col-sm-6">'+
                            '<a href="/trend/' + trend.pk + '">'+
                                '<h3>'+trend_fields.name+'</h3>'+
                                '<p>'+trend_fields.short_description+'</p>'+
                            '</a>'+
                        '</div>';
                    }
                    trend_html += '</div>'
                }

                var project_html = '';
                if (projects.length > 0) {
                    project_html += '<div class="row">'+
                        '<div class="col-12"><h1>Projects</h1></div>';

                    for (i = 0; i < projects.length; i++) {
                        project = projects[i];
                        project_fields = project.fields;

                        project_html += '<div class="search-result project col-xs-12 col-sm-6">'+
                            '<a href="/project/' + project.pk + '">'+
                                '<h3>'+project_fields.name+'</h3>'+
                                '<p>'+project_fields.short_description+'</p>'+
                            '</a>'+
                        '</div>';
                    }
                    project_html += '</div>'
                }

                if ($('#search_box').val() != '' && trend_html == '' && project_html == '') {
                    $('#results div').html('<h1>No results found</h1>');
                }
                else {
                    $('#results div').html(trend_html + project_html);
                }
            });
        }, 200));

        $('#search-bar').on('keyup keypress', function(e) {
            var keyCode = e.keyCode || e.which;
            if (keyCode === 13) {
                e.preventDefault();
                return false;
            }
        });

        <!--Search bar on and off-->
        $(function () {
            $('a[href="#search"]').on('click', function(event) {
                event.preventDefault();
                $('#search').addClass('open');
                $('#search').addClass('on');
                $('#search input[type="search"]').focus();
                $('.blur-field').addClass('blur').addClass('on');
                $('.parallax').css('overflow-y', 'hidden');

                $("#results div").html("");
                $('body').css('overflow', 'hidden');
            });

            $('#search, #close-search, #search button.close, #close-search button.close').on('click keyup', function(event) {
                if (event.target == this || event.target.className == 'close' || event.keyCode == 27) {
                    $('#search').removeClass('open');
                    $('#search').removeClass('on');
                    $('.blur-field').removeClass('blur').removeClass('on');
                    $('.parallax').css('overflow-y', 'auto');

                    $("#results div").html("");
                    $('body').css('overflow', 'auto');
                }
            });
        });


        function debounce(func, wait, immediate) {
            var timeout;
            return function() {
                var context = this, args = arguments;
                clearTimeout(timeout);
                timeout = setTimeout(function() {
                    timeout = null;
                    if (!immediate) func.apply(context, args);
                }, wait);
                if (immediate && !timeout) func.apply(context, args);
            };
        }

        window.onresize = function scaleCards() {

            $('.card').css("height", function() {
                return $('.card-img-overlay').width() * (7/10);
            });

            $('.card-img').css("height", function() {
                return $('.card-img-overlay').width() * (7/10);
            });

            $('.card-container').css("height", function() {
                return $('.card-img-overlay').width() * (7/10);
            });

            $('#card-container.card').css("height", function() {
                return $('.card-img-overlay').width() * (7/10);
            });
        };


        $('.card').css("height", function() {
            return $('.card-img-overlay').width() * (7/10);
        });

        $('.card-img').css("height", function() {
            return $('.card-img-overlay').width() * (7/10);
        });

        $('.card-container').css("height", function() {
            return $('.card-img-overlay').width() * (7/10);
        });

        $('#card-container.card').css("height", function() {
            return $('.card-img-overlay').width() * (7/10);
        });

//        Really bad fix for the scrolling issue on some browsers below. 


//        var bottomReachedBefore = false;
//        var parallaxDistanceFromTop;
//        $('.parallax').scroll(function() {
//            var scrollPoint = $('.footer1').offset().top;
//            var topOfPageToFooter = ($(window).height() - $('.footer1').height());
//            if (scrollPoint < topOfPageToFooter) {
//                if (!bottomReachedBefore) {
//                    bottomReachedBefore = true;
//                    parallaxDistanceFromTop = $('.parallax').scrollTop();
//                }
//                $('.parallax').scrollTop(parallaxDistanceFromTop);
//            }
//        });

        </script>

        <!-- Include page-specific scripts -->
        {% block scripts %}{% endblock %}
    </body>
</html>