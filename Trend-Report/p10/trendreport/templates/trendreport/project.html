{% extends "trendreport/base.html" %}
{% load static %}
{% block title %} {{ project.name }} {% endblock %}
{% block facebookmeta %}
    <meta property="fb:app_id" content="1878293905819089" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="http://trends.techlab.works/project/{{ project.id }}" />
    <meta property="og:title" content="{{ project.name }}" />
    <meta property="og:description" content="{{ project.short_description }}" />
    <meta property="og:image" content="http://trends.techlab.works{% static project.background %}" />
    <meta property="og:image:alt" content="The Trend Report" />
    <meta property="og:image:width" content="600" />
    <meta property="og:image:height" content="350" />
{% endblock %}

{% block backupWallpaper %}<img class="big-box blur-field">{% endblock %}

{% block content %}
<div class="col content-overlay">
    <div class="row">
        <!--Project description -->
        <div class="col-12 col-md-8">
            <h1 class="display-4">{{ project.name }}</h1>
            <div id="Project">
                <p>{{ project.description | safe }}</p>
            </div>
            <br/>
            <br/>
            Tags:
            {% for tag in project.tags %}
                <p class="badge badge-secondary" data-value="{{ tag.name }}" >{{ tag.name }}</p>
            {% endfor %}
            <hr/>
            <!--Facebook comments api-->
            <div class="fb-comments"
                 data-href="http://trends.techlab.works/project/{{ project.id }}"
                 data-width="100%"
                 data-numposts="5"
                 data-colorscheme="dark">
            </div>
            <div class="fb-like"
                 data-href="http://trends.techlab.works/project/{{ project.id }}"
                 data-layout="button_count"
                 data-action="like"
                 data-size="large"
                 data-show-faces="false"
                 data-share="true">
            </div>
        </div>

        <!--Related stuff column-->
        <div class="col-12 col-md-4 related-column">

            {% if project.trends %}
                <div id="related-trends">
                    <h3>Related Trends</h3>

                    {% for trend in project.trends %}
                        <div class="related_trend">
                            <a href="{% url 'trend_page' trend.id %}">
                                <h5>{{ trend.name }}</h5>
                                <img class="img-fluid" src="{% static trend.background %}"/>
                                {% with trend.short_description|add:"..." as description %}
                                    <p>{{ description }}</p>
                                {% endwith %}
                            </a>
                            <div class="clearfix"></div>
                        </div>
                    {% endfor %}
                <hr style="margin-top: 0;"/>
                </div>
                {% if project.trends|length > 3 %}
                    <button type="button" class="btn btn-block btn-load" id="load_trends" >Load More Trends</button>
                {% endif %}
                <br/>

            {% endif %}


            {% if project.projects %}
                <div id="related-projects">
                    <h3>Related Projects</h3>

                    {% for project in project.projects %}
                        <div class="related_project">
                            <a href="{% url 'project_page' project.id %}">
                                <h5>{{ project.name }}</h5>
                                <img class="img-fluid" src="{% static project.background %}"/>
                                {% with project.short_description|add:"..." as description %}
                                    <p>{{ description }}</p>
                                {% endwith %}
                            </a>
                        </div>
                    {% endfor %}
                <hr style="margin-top: 0;"/>
                </div>
                {% if project.projects|length > 3 %}
                    <button type="button" class="btn btn-block btn-load" id="load_projects" >Load More Projects</button>
                {% endif %}
                <br/>
                <br/>
            {% endif %}


            {% if project.principles %}
                {% for principle in project.principles %}
                    <a href="{% url 'principles_page' %}">
                        <h6>
                            <i class="fa fa-{{ principle.icon }}" aria-hidden="true"></i>
                            {{ principle.name }}
                        </h6>
                    </a>
                {% endfor %}
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function getImagePath() {
        return "{% static project.background %}";
    }
    window.onload = function() {
        $("#project-background").attr('src', getImagePath());
    };
</script>

<script>
    $('.badge').on('click', function(event) {
        $('a[href="#search"]').click();
        $('#search_box').val(this.getAttribute('data-value')).trigger('keyup');
    });
</script>

<script>
    $(document).ready(function(){

        $(".related_project").hide();
        $(".related_project").slice(0, 3).show();

        $("#load_projects").click(function(e){
            e.preventDefault();

           if($(".related_project:hidden").length == 0){
                $(".related_project:gt(2)").hide(300);
                $("#load_projects").html('Load More Projects');
            }
           else {
                $(".related_project:gt(2)").show(300);
                $("#load_projects").html('Show Less');
           }
        });

        $(".related_trend").hide();
        $(".related_trend").slice(0, 3).show();

        $("#load_trends").click(function(e){
            e.preventDefault();

           if($(".related_trend:hidden").length == 0) {
                $(".related_trend:gt(2)").hide(300);
                $("#load_trends").html('Load More Trends');
           }
           else {
                $(".related_trend:gt(2)").show(300);
                $("#load_trends").html('Show Less');
           }
        });
    });
</script>

<script>
    if ((navigator.userAgent.search("MSIE") >= 0) || (navigator.userAgent.search("Firefox") >= 0) || (navigator.userAgent.search("Safari") >= 0 && navigator.userAgent.search("Chrome") < 0) || (navigator.userAgent.search("Opera") >= 0)) {
        $('div').removeClass("parallax").removeClass("parallax__layer").removeClass("parallax__layer--back").removeClass("parallax__layer--base")
        $('#project-background').remove();
        $('html').css({"background-color": "#232323", "opacity": "1"});
        $('body').attr("background", "{% static project.background %}").css({"background-size": "cover", "background-position": "center", "background-attachment": "fixed"})

    } else {
        $('.big-box').remove();
    }
</script>
{% endblock %}


{% block facebook %}
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '1878293905819089',
      xfbml      : true,
      version    : 'v2.10'
    });
    FB.AppEvents.logPageView();
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>
{% endblock %}


{% block parallex_open %}
<div class="parallax" style="object-fit: cover;">
    <div class="parallax__layer parallax__layer--back" style="object-fit: cover;">
        <div class="blur-field">
            <img src="" id="project-background" name="project-background" style="object-fit: cover;">
        </div>
    </div>
    <div class="parallax__layer parallax__layer--base">
{% endblock %}


{% block parallex_close %}
    </div>
</div>
{% endblock %}
